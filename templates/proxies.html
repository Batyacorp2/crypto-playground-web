{% extends "base.html" %}
{% block title %}Прокси - Crypto Playground{% endblock %}
{% block content %}
<div class="content-wrapper">
    <div class="page-header">
        <h1>Тестирование прокси серверов</h1>
        <p>Загрузите список прокси для тестирования и получения уникальных IP адресов</p>
    </div>

    <div class="proxy-container">
        <div class="proxy-input-section">
            <div class="card">
                <div class="card-header">
                    <h3>Ввод прокси</h3>
                    <div class="format-info">
                        <small>Поддерживаемые форматы:</small>
                        <ul>
                            <li>domain:port:username:password</li>
                            <li>username:password@domain:port</li>
                            <li>http://username:password@domain:port</li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <textarea id="proxyInput" class="form-control" rows="12" 
                              placeholder="Вставьте список прокси серверов...&#10;Пример:&#10;proxy1.example.com:8080:user1:pass1&#10;user2:pass2@proxy2.example.com:3128&#10;http://user3:pass3@proxy3.example.com:1080"></textarea>
                    <div class="input-actions">
                        <button id="testProxies" class="btn btn-primary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 12l2 2 4-4"/>
                                <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
                                <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
                            </svg>
                            Тестировать прокси
                        </button>
                        <button id="stopTesting" class="btn btn-danger" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="6" y="6" width="12" height="12"/>
                            </svg>
                            Остановить
                        </button>
                        <button id="clearInput" class="btn btn-secondary">Очистить</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="proxy-results-section">
            <div class="card">
                <div class="card-header">
                    <h3>Результаты тестирования</h3>
                </div>
                <div class="card-body">
                    <div class="progress-section" style="display: none;">
                        <div class="progress-info">
                            <div class="progress-stats">
                                <span class="progress-text">Подготовка к тестированию...</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-label">Протестировано:</span>
                                <span id="testedCount" class="stat-value">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Рабочих:</span>
                                <span id="workingCount" class="stat-value">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Уникальных IP:</span>
                                <span id="uniqueCount" class="stat-value">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Не работают:</span>
                                <span id="failedCount" class="stat-value">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="results-section" style="display: none;">
                        <div class="results-header">
                            <h4>Результаты тестирования</h4>
                            <div class="results-actions">
                                <button id="copyResults" class="btn btn-secondary">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                    </svg>
                                    Copy
                                </button>
                                <button id="exportTsv" class="btn btn-info">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7,10 12,15 17,10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                    Выгрузить.tsv
                                </button>
                                <button id="syncDb" class="btn btn-success" style="display: none;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                    </svg>
                                    Загрузить в БД
                                </button>
                            </div>
                        </div>
                        
                        <div class="results-tabs">
                            <div class="tab-header">
                                <button class="tab-btn active" data-tab="working">Рабочие (<span id="workingProxiesCount">0</span>)</button>
                                <button class="tab-btn" data-tab="unique">Уникальные IP (<span id="uniqueProxiesCount">0</span>)</button>
                            </div>
                            <div class="tab-content">
                                <div id="workingProxies" class="proxy-list tab-pane active"></div>
                                <div id="uniqueProxies" class="proxy-list tab-pane"></div>
                            </div>
                        </div>
                    </div>

                    <div id="noResults" class="no-results" style="display: none;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                        <h4>Рабочие прокси не найдены</h4>
                        <p>Попробуйте другой список прокси серверов</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/proxies.js') }}"></script>
{% endblock %}